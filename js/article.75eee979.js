"use strict";(self["webpackChunkHeimatoutiao"]=self["webpackChunkHeimatoutiao"]||[]).push([[942],{2783:function(t,e,i){i.r(e),i.d(e,{default:function(){return F}});var s=function(){var t=this,e=t._self._c;return e("div",[e("van-nav-bar",{attrs:{title:"文章详情","left-arrow":""},on:{"click-left":function(e){return t.$router.back()}}}),e("div",{staticClass:"article-wrap"},[e("h1",{staticClass:"title"},[t._v(t._s(t.article.title))]),e("van-cell",{staticClass:"user-info",attrs:{center:""}},[e("div",{staticClass:"name",attrs:{slot:"title"},slot:"title"},[t._v(t._s(t.article.aut_name))]),e("van-image",{staticClass:"user-avatar",attrs:{slot:"icon",round:"",fit:"cover",src:t.article.aut_photo},slot:"icon"}),e("div",{staticClass:"time",attrs:{slot:"label"},slot:"label"},[t._v(" "+t._s(t._f("relativeTime")(t.article.pubdate))+" ")]),e("van-button",{staticClass:"right-btn",attrs:{type:t.article.is_followed?"default":"info",round:"",size:"small",icon:t.article.is_followed?"":"plus",loading:t.isFollowLoading},on:{click:t.onFollow}},[t._v(t._s(t.article.is_followed?"已关注":"关注")+" ")])],1),e("div",{ref:"article-content",staticClass:"content markdown-body",domProps:{innerHTML:t._s(t.article.content)}}),e("CommentList",{attrs:{source:t.articleId},on:{"update-total-count":function(e){t.totalCommentCount=e},"reply-click":t.onReplyClick}})],1),e("div",{staticClass:"article-bottom"},[e("van-button",{staticClass:"comment-btn",attrs:{type:"default",round:"",size:"small"},on:{click:function(e){t.showPost=!0}}},[t._v("写评论")]),e("van-icon",{attrs:{name:"comment-o",info:t.totalCommentCount,color:"#777"}}),e("van-icon",{attrs:{name:t.article.is_collected?"star":"star-o",color:t.article.is_collected?"orange":"#777"},on:{click:t.onCollect}}),e("van-icon",{attrs:{name:1===t.article.attitude?"good-job":"good-job-o",color:1===t.article.attitude?"hotpink":"#777"},on:{click:t.onLike}}),e("van-icon",{attrs:{name:"share",color:"#777"}})],1),e("van-popup",{attrs:{position:"bottom"},model:{value:t.showPost,callback:function(e){t.showPost=e},expression:"showPost"}},[e("post-comment",{attrs:{articleId:t.articleId,target:t.articleId},on:{"on-post-success":t.onCommentSuccess}})],1),e("van-popup",{attrs:{position:"bottom"},model:{value:t.showReply,callback:function(e){t.showReply=e},expression:"showReply"}},[e("CommentReply",{attrs:{comment:t.replyComment}})],1)],1)},o=[],a=(i(7658),function(){var t=this,e=t._self._c;return e("div",{staticClass:"comment-reply"},[e("van-nav-bar",{attrs:{title:`${t.comment.reply_count}条回复`}},[e("van-icon",{attrs:{slot:"left",name:"cross"},slot:"left"})],1),e("comment-item",{attrs:{comment:t.comment}})],1)}),n=[],l=function(){var t=this,e=t._self._c;return e("van-cell",{staticClass:"comment-item",attrs:{title:"123"}},[e("van-image",{staticClass:"avatar",attrs:{slot:"icon",round:"",fit:"cover",src:t.comment.aut_photo},slot:"icon"}),e("div",{attrs:{slot:"title"},slot:"title"},[e("div",{staticClass:"title-warp"},[e("div",{staticClass:"name"},[t._v(t._s(t.comment.aut_name))]),e("div",{staticClass:"like-wrap",on:{click:t.onLike}},[e("van-icon",{class:{liked:t.comment.is_liking},attrs:{name:t.comment.is_liking?"good-job":"good-job-o"}}),e("span",{class:{liked:t.comment.is_liking}},[t._v(t._s(t.comment.like_count))])],1)]),e("div",{staticClass:"content"},[t._v(t._s(t.comment.content))]),e("div",{staticClass:"time"},[e("span",[t._v(t._s(t._f("datetime")(t.comment.pubdate,"MM-DD HH:ss")))]),e("van-button",{staticClass:"reply-btn",attrs:{round:"",size:"mini"},on:{click:function(e){return t.$emit("reply-click",t.comment)}}},[t._v(" "+t._s(t.comment.reply_count)+" 回复 ")])],1)])],1)},c=[],r=i(7756),m={name:"CommentItem",props:{comment:{type:Object,required:!0}},methods:{async onLike(){const t=this.comment.com_id.toString();this.comment.is_liking?(await(0,r.Zg)(t),this.comment.like_count--):(await(0,r.Ou)(t),this.comment.like_count++),this.comment.is_liking=!this.comment.is_liking}}},d=m,u=i(1001),h=(0,u.Z)(d,l,c,!1,null,"530a8c1f",null),p=h.exports,g={name:"CommentReply",components:{commentItem:p},props:{comment:{type:Object,default:()=>{}}}},f=g,v=(0,u.Z)(f,a,n,!1,null,"1f2f6ee8",null),_=v.exports,C=function(){var t=this,e=t._self._c;return e("div",[e("van-cell",{attrs:{title:"全部评论"}}),e("van-list",{attrs:{finished:t.finished,"finished-text":"没有更多了"},on:{load:t.onLoad},model:{value:t.loading,callback:function(e){t.loading=e},expression:"loading"}},t._l(t.list,(function(i,s){return e("comment-item",{key:s,attrs:{comment:i},on:{"reply-click":function(e){return t.$emit("reply-click",e)}}})})),1)],1)},w=[],k={name:"CommentList",components:{CommentItem:p},props:{source:{type:[String,Number,Object],required:!0}},data(){return{loading:!1,finished:!1,offset:null,limit:10,list:[]}},methods:{async onLoad(){const{data:t}=await(0,r.li)({type:"a",source:this.source,offset:this.offset,limit:this.limit});this.$emit("update-total-count",t.total_count);const{results:e}=t;this.list=[...this.list,...e],this.loading=!1,e.length?this.offset=t.last_id:this.finished=!0}}},y=k,b=(0,u.Z)(y,C,w,!1,null,"b5d3a514",null),I=b.exports,x=function(){var t=this,e=t._self._c;return e("div",{staticClass:"post-comment"},[e("van-field",{attrs:{rows:"2",type:"textarea",maxlength:"120",placeholder:"请输入评论 ","show-word-limit":""},model:{value:t.message,callback:function(e){t.message="string"===typeof e?e.trim():e},expression:"message"}}),e("van-button",{staticClass:"on-post",attrs:{type:"primary",disabled:t.message===t.message.trim()&&0===t.message.length},on:{click:t.onPost}},[t._v("发布")])],1)},L=[],P={name:"PostComment",data(){return{message:""}},props:{target:{type:[String,Number,Object],required:!0},articleId:{type:[String,Number,Object],default:null}},methods:{async onPost(){const{data:t}=await(0,r.Ir)({target:this.target.toString(),content:this.message,art_id:null===this.articleId?this.articleId.toString():null});this.$emit("on-post-success",t),this.message=""}}},j=P,$=(0,u.Z)(j,x,L,!1,null,"4f68ea25",null),R=$.exports,S=i(993),z={name:"ArticeIndex",data(){return{article:{},isFollowLoading:!1,isCollectLoading:!1,showPost:!1,totalCommentCount:0,showReply:!1,replyComment:{}}},components:{CommentList:I,PostComment:R,CommentReply:_},created(){this.loadArticle()},props:{articleId:{type:[String,Number,Object],required:!0}},methods:{onReplyClick(t){this.showReply=!0},async onFollow(){this.isFollowLoading=!0,this.article.is_followed?(await(0,r.VR)(this.article.aut_id),this.$toast("已取消关注")):(await(0,r.R3)(this.article.aut_id),this.$toast("已关注")),this.article.is_followed=!this.article.is_followed,this.isFollowLoading=!0},async onCollect(){this.$toast.loading({forbidClick:!0,message:"加载中..."}),this.isCollectLoading=!0,this.article.is_collected?await(0,r.qI)(this.articleId):await(0,r._Y)(this.articleId),this.article.is_followed=!this.article.is_followed,this.isCollectLoading=!0,this.$toast.success((this.article.is_collected?"取消":"")+"收藏成功")},async onLike(){1===this.article.attitude?(await(0,r.Nk)(this.articleId),this.article.attitude=-1):(await(0,r.dE)(this.articleId),this.article.attitude=1),this.$toast.success((1===this.article.attitude?"":"取消")+"点赞成功")},async loadArticle(){const{data:t}=await(0,r.fq)(this.articleId);this.article=t,this.replaceAutPhoto(),this.replaceContentImg(),this.$nextTick((()=>{this.handlePerviewImage()}))},handlePerviewImage(){const t=this.$refs["article-content"],e=t.querySelectorAll("img"),i=[];e.forEach(((t,e)=>{i.push(t.src),t.onclick=function(){(0,S.Z)({images:i,startPosition:e})}}))},replaceAutPhoto(){let t=["https://img01.yzcdn.cn/vant/cat.jpeg","https://img01.yzcdn.cn/vant/logo.png","https://static.wikia.nocookie.net/fcs-vs-battle/images/3/35/ASDFGuy_Vector.png/revision/latest?cb=20201113171318","https://www.aplpackaging.co.uk/wp-content/uploads/2019/12/mailingbox-brown-310x240x114-000-300x300.jpg"],e=Math.floor(Math.random()*t.length);this.article.aut_photo=t[e]},replaceContentImg(){this.article.content=this.article.content.replace(/\/\/upload-images.*?['"]/g,"https://img01.yzcdn.cn/vant/cat.jpeg"),this.article.content=this.article.content.replace(/src=".*?['"]/g,'src="https://img01.yzcdn.cn/vant/cat.jpeg"'),this.article.content=this.article.content.replace(/data-original-src=".*?['"]/g,'src="https://img01.yzcdn.cn/vant/cat.jpeg"')},onCommentSuccess(t){this.$toast.loading({message:"发布中...",forbidClick:!0}),this.replyComment=t,this.totalCommentCount++,this.$toast.success("评论成功"),this.showPost=!1}}},q=z,A=(0,u.Z)(q,s,o,!1,null,"12d0ad34",null),F=A.exports}}]);
//# sourceMappingURL=article.75eee979.js.map