"use strict";(self["webpackChunkHeimatoutiao"]=self["webpackChunkHeimatoutiao"]||[]).push([[942],{708:function(t,i,e){e.r(i),e.d(i,{default:function(){return y}});var a=function(){var t=this,i=t._self._c;return i("div",[i("van-nav-bar",{attrs:{title:"文章详情","left-arrow":""},on:{"click-left":function(i){return t.$router.back()}}}),i("div",{staticClass:"article-wrap"},[i("h1",{staticClass:"title"},[t._v(t._s(t.article.title))]),i("van-cell",{staticClass:"user-info",attrs:{center:""}},[i("div",{staticClass:"name",attrs:{slot:"title"},slot:"title"},[t._v(t._s(t.article.aut_name))]),i("van-image",{staticClass:"user-avatar",attrs:{slot:"icon",round:"",fit:"cover",src:t.article.aut_photo},slot:"icon"}),i("div",{staticClass:"time",attrs:{slot:"label"},slot:"label"},[t._v(" "+t._s(t._f("relativeTime")(t.article.pubdate))+" ")]),i("van-button",{staticClass:"right-btn",attrs:{type:t.article.is_followed?"default":"info",round:"",size:"small",icon:t.article.is_followed?"":"plus",loading:t.isFollowLoading},on:{click:t.onFollow}},[t._v(t._s(t.article.is_followed?"已关注":"关注")+" ")])],1),i("div",{ref:"article-content",staticClass:"content markdown-body",domProps:{innerHTML:t._s(t.article.content)}}),i("CommentList",{attrs:{source:t.articleId}})],1),i("div",{staticClass:"article-bottom"},[i("van-button",{staticClass:"comment-btn",attrs:{type:"default",round:"",size:"small"}},[t._v("写评论")]),i("van-icon",{attrs:{name:"comment-o",info:"123",color:"#777"}}),i("van-icon",{attrs:{name:t.article.is_collected?"star":"star-o",color:t.article.is_collected?"orange":"#777"},on:{click:t.onCollect}}),i("van-icon",{attrs:{name:1===t.article.attitude?"good-job":"good-job-o",color:1===t.article.attitude?"hotpink":"#777"},on:{click:t.onLike}}),i("van-icon",{attrs:{name:"share",color:"#777"}})],1)],1)},s=[],o=(e(7658),function(){var t=this,i=t._self._c;return i("div",[i("van-cell",{attrs:{title:"全部评论"}}),i("van-list",{attrs:{finished:t.finished,"finished-text":"没有更多了"},on:{load:t.onLoad},model:{value:t.loading,callback:function(i){t.loading=i},expression:"loading"}},t._l(t.list,(function(t,e){return i("comment-item",{key:e,attrs:{comment:t}})})),1)],1)}),l=[],n=e(7756),c=function(){var t=this,i=t._self._c;return i("van-cell",{staticClass:"comment-item",attrs:{title:"123"}},[i("van-image",{staticClass:"avatar",attrs:{slot:"icon",round:"",fit:"cover",src:t.comment.aut_photo},slot:"icon"}),i("div",{attrs:{slot:"title"},slot:"title"},[i("div",{staticClass:"title-warp"},[i("div",{staticClass:"name"},[t._v(t._s(t.comment.aut_name))]),i("div",{staticClass:"like-wrap",on:{click:t.onLike}},[i("van-icon",{class:{liked:t.comment.is_liking},attrs:{name:t.comment.is_liking?"good-job":"good-job-o"}}),i("span",{class:{liked:t.comment.is_liking}},[t._v(t._s(t.comment.like_count))])],1)]),i("div",{staticClass:"content"},[t._v(t._s(t.comment.content))]),i("div",{staticClass:"time"},[i("span",[t._v(t._s(t._f("datetime")(t.comment.pubdate,"MM-DD HH:ss")))]),i("van-button",{staticClass:"reply-btn",attrs:{round:"",size:"mini"}},[t._v(" "+t._s(t.comment.reply_count)+"回复 ")])],1)])],1)},r=[],d={name:"CommentItem",props:{comment:{type:Object,required:!0}},methods:{async onLike(){const t=this.comment.com_id.toString();this.comment.is_liking?(await(0,n.Zg)(t),this.comment.like_count--):(await(0,n.Ou)(t),this.comment.like_count++),this.comment.is_liking=!this.comment.is_liking}}},m=d,h=e(1001),u=(0,h.Z)(m,c,r,!1,null,"38e94a14",null),g=u.exports,p={name:"CommentList",components:{CommentItem:g},props:{source:{type:[String,Number,Object],required:!0}},data(){return{list:[],loading:!1,finished:!1,offset:null,limit:10}},methods:{async onLoad(){const{data:t}=await(0,n.li)({type:"a",source:this.source,offset:this.offset,limit:this.limit}),{results:i}=t;this.list=[...this.list,...i],this.loading=!1,i.length?this.offset=t.last_id:this.finished=!0}}},_=p,v=(0,h.Z)(_,o,l,!1,null,"7a995c9b",null),f=v.exports,k=e(993),w={name:"Artice",data(){return{article:{},isFollowLoading:!1,isCollectLoading:!1}},components:{CommentList:f},created(){this.loadArticle()},props:{articleId:{type:[String,Number,Object],required:!0}},methods:{async onFollow(){this.isFollowLoading=!0,this.article.is_followed?(await(0,n.VR)(this.article.aut_id),this.$toast("已取消关注")):(await(0,n.R3)(this.article.aut_id),this.$toast("已关注")),this.article.is_followed=!this.article.is_followed,this.isFollowLoading=!0},async onCollect(){this.$toast.loading({forbidClick:!0,message:"加载中..."}),this.isCollectLoading=!0,this.article.is_collected?await(0,n.qI)(this.articleId):await(0,n._Y)(this.articleId),this.article.is_followed=!this.article.is_followed,this.isCollectLoading=!0,this.$toast.success((this.article.is_collected?"取消":"")+"收藏成功")},async onLike(){this.$toast.loading({forbidClick:!0,message:"加载中..."}),1===this.article.attitude?(await(0,n.Nk)(this.articleId),this.article.attitude=-1):(await(0,n.dE)(this.articleId),this.article.attitude=1),this.$toast.success((1===this.article.attitude?"":"取消")+"点赞成功")},async loadArticle(){const{data:t}=await(0,n.fq)(this.articleId);this.article=t,this.replaceAutPhoto(),this.replaceContentImg(),this.$nextTick((()=>{this.handlePerviewImage()}))},handlePerviewImage(){const t=this.$refs["article-content"],i=t.querySelectorAll("img"),e=[];i.forEach(((t,i)=>{e.push(t.src),t.onclick=function(){(0,k.Z)({images:e,startPosition:i})}}))},replaceAutPhoto(){let t=["https://img01.yzcdn.cn/vant/cat.jpeg","https://img01.yzcdn.cn/vant/logo.png","https://static.wikia.nocookie.net/fcs-vs-battle/images/3/35/ASDFGuy_Vector.png/revision/latest?cb=20201113171318","https://www.aplpackaging.co.uk/wp-content/uploads/2019/12/mailingbox-brown-310x240x114-000-300x300.jpg"],i=Math.floor(Math.random()*t.length);this.article.aut_photo=t[i]},replaceContentImg(){this.article.content=this.article.content.replace(/\/\/upload-images.*?['"]/g,"https://img01.yzcdn.cn/vant/cat.jpeg"),this.article.content=this.article.content.replace(/src=".*?['"]/g,'src="https://img01.yzcdn.cn/vant/cat.jpeg"'),this.article.content=this.article.content.replace(/data-original-src=".*?['"]/g,'src="https://img01.yzcdn.cn/vant/cat.jpeg"')}}},b=w,C=(0,h.Z)(b,a,s,!1,null,"75c3b586",null),y=C.exports}}]);
//# sourceMappingURL=article.f0c0babc.js.map